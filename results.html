<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ontario Election Results Map</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
    <style>
        body {
            font-family: 'Arial', sans-serif;
            text-align: center;
            margin: 0;
            padding: 0;
            background-color: #f8f9fa;
            color: #333;
        }

        h2 {
            margin: 15px 0;
            font-size: 1.8em;
            font-weight: bold;
            color: #222;
        }

        #container {
            max-width: 95%;
            margin: 0 auto;
            padding: 15px;
        }

        .btn {
            display: inline-block;
            padding: 12px 18px;
            font-size: 16px;
            font-weight: bold;
            text-decoration: none;
            border-radius: 5px;
            cursor: pointer;
            border: none;
            transition: all 0.2s ease-in-out;
        }

        .btn-primary {
            background-color: #007bff;
            color: white;
        }
        .btn-primary:hover { background-color: #0056b3; }

        .btn-danger {
            background-color: #dc3545;
            color: white;
            display: none;
        }
        .btn-danger:hover { background-color: #c82333; }

        #party-summary {
            padding: 15px;
            background: white;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            margin-bottom: 15px;
            text-align: left;
            font-size: 16px;
        }

        #party-summary div {
            padding: 8px;
            font-weight: bold;
        }

        #map {
            height: 450px;
            width: 100%;
            margin: 10px auto;
            border-radius: 10px;
            border: 2px solid #ddd;
        }

        #info {
            padding: 15px;
            font-size: 16px;
            background: white;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            margin-bottom: 15px;
            text-align: left;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 10px;
            background: white;
            border-radius: 8px;
            overflow: hidden;
        }

        th, td {
            border: 1px solid #ddd;
            padding: 12px;
            text-align: center;
        }

        th {
            background-color: #007bff;
            color: white;
            font-size: 16px;
        }

        tr:nth-child(even) { background-color: #f2f2f2; }
        tr:hover { background-color: #ddd; }

        footer {
            margin-top: 20px;
            padding: 15px;
            font-size: 14px;
            color: #555;
            background: #e9ecef;
            border-top: 1px solid #ccc;
        }

        @media screen and (max-width: 600px) {
            h2 { font-size: 1.5em; }
            #map { height: 350px; }
            #party-summary, #info { font-size: 14px; padding: 10px; }
            table { font-size: 14px; }
            .btn { padding: 10px 14px; font-size: 14px; }
        }
    </style>
</head>
<body>

    <div id="container">
        <header>
            <h1>2025 Ontario Election Results</h1>
            <p class="subheading">Election results with interactive mapping</p>
            <p class="subheading">Move the map and tap to select an electoral district.</p>
        </header>
    
        <div class="button-container">
            <a href="index.html" class="btn btn-primary">Back to Home</a>
        </div>
    
        <div id="party-summary" class="card">Loading election data...</div>
    
        <div id="map" class="map-container"></div>
    
        <div id="info" class="info-box">Tap on a riding to view results.</div>
    
        <div class="button-container">
            <button id="clear-btn" class="btn btn-danger" onclick="clearSelection()">üóëÔ∏è Clear Selection</button>
        </div>
    </div>
    

    <footer>
        <p>Disclaimer: This website is for informational purposes only. No liability is assumed for inaccuracies.</p>
        <p>Last updated: <strong>12:53 AM, February 28, 2025</strong></p>
    </footer>

    <script>
        var map = L.map('map').setView([50, -85], 5);
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            attribution: '¬© OpenStreetMap contributors'
        }).addTo(map);
    
        var geojsonData = "electoral_districts.geojson";
        var electionResults = "election_results.json";
        var electionData = {};
        var ridingLayers = {};
        var selectedLayer = null;
        var partyCount = {};
    
        function getColor(party) {
            return {
                "PC": "blue",
                "Liberal": "red",
                "NDP": "orange",
                "Green": "green",
                "IND": "gray"
            }[party] || "gray";
        }
    
        function shortenPartyName(party) {
            if (party.includes("PC")) return "PC";
            if (party.includes("Liberal")) return "Liberal";
            if (party.includes("NDP")) return "NDP";
            if (party.includes("Green")) return "Green";
            return party;
        }
    
        function updatePartySummary() {
            let summaryDiv = document.getElementById("party-summary");
    
            if (Object.keys(partyCount).length === 0) {
                summaryDiv.innerHTML = "No election data available.";
                return;
            }
    
            let summaryHTML = `<table style="margin: auto; width: 40%; border-collapse: collapse;">
                                <tr><th>Party</th><th>Seats</th></tr>`;
    
            Object.entries(partyCount)
                .sort((a, b) => b[1] - a[1])
                .forEach(([party, seats]) => {
                    summaryHTML += `<tr>
                                        <td style="color: ${getColor(party)}; font-weight: bold;">${party}</td>
                                        <td>${seats}</td>
                                    </tr>`;
                });
    
            summaryHTML += "</table>";
            summaryDiv.innerHTML = summaryHTML;
        }
    
        function clearSelection() {
            if (selectedLayer) {
                selectedLayer.setStyle({ weight: 1, fillOpacity: 0.5 });
                selectedLayer = null;
            }
            document.getElementById("info").innerHTML = "Tap on a riding to view results.";
            document.getElementById("clear-btn").style.display = "none";
            map.setView([50, -85], 5);
        }
    
        function selectRiding(riding) {
            if (!ridingLayers[riding]) return;
            if (selectedLayer) selectedLayer.setStyle({ weight: 1, fillOpacity: 0.5 });
    
            selectedLayer = ridingLayers[riding];
            selectedLayer.setStyle({ weight: 3, fillOpacity: 0.8 });
    
            document.getElementById("info").innerHTML = `<h3>${riding}</h3>` + formatResults(electionData[riding]);
            document.getElementById("clear-btn").style.display = "block";
    
            map.fitBounds(selectedLayer.getBounds(), { maxZoom: 10 });
        }
    
        function formatResults(results) {
            if (!results || results.length === 0) return "<p>No data available</p>";
            let table = `<table><tr><th>Candidate</th><th>Party</th><th>Votes</th><th>Percentage</th></tr>`;
            results.forEach(r => {
                table += `<tr>
                            <td>${r.Candidate}</td>
                            <td>${shortenPartyName(r.Party)}</td>
                            <td>${r.Votes.toLocaleString()}</td>
                            <td>${r.Percentage}</td>
                          </tr>`;
            });
            return table + `</table>`;
        }
    
        fetch(electionResults)
            .then(response => response.json())
            .then(data => {
                electionData = data;
                fetch(geojsonData)
                    .then(response => response.json())
                    .then(geoData => {
                        L.geoJson(geoData, {
                            style: function (feature) {
                                let riding = feature.properties.ENGLISH_NA;
                                let result = electionData[riding];
    
                                if (result && result.length > 0) {
                                    let winningParty = shortenPartyName(result[0].Party);
                                    partyCount[winningParty] = (partyCount[winningParty] || 0) + 1;
                                }
    
                                return { color: "black", weight: 1, fillColor: result ? getColor(shortenPartyName(result[0].Party)) : "gray", fillOpacity: 0.5 };
                            },
                            onEachFeature: function (feature, layer) {
                                let riding = feature.properties.ENGLISH_NA;
                                ridingLayers[riding] = layer;
                                layer.on("click", () => selectRiding(riding));
                            }
                        }).addTo(map);
    
                        updatePartySummary();
                    });
            });
    </script>
    

</body>
</html>
